<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Sign up / Login Form</title>
  <link rel="stylesheet" href="./style.css">
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
</head>
<body>
  <div class="main">  
    <!-- Окно выбора роли -->
    <div class="role-selection" id="roleSelection">
      <h2>Кто вы?</h2>
      <button onclick="selectRole('couple')">Молодожены</button>
      <button onclick="selectRole('manager')">Менеджер</button>
    </div>

    <!-- Формы регистрации и входа -->
    <div class="forms" id="forms" style="display: none;">
      <input type="checkbox" id="chk" aria-hidden="true">

      <div class="signup" id="signup">
       <form id="signupForm" action="qwe.php" method="POST">
          <label for="chk" aria-hidden="true">Sign up</label>
          <div id="coupleFields">
              <input type="text" name="groomName" placeholder="Имя жениха" required>
    <input type="text" name="brideName" placeholder="Имя невесты" required>
    <input type="text" name="phone" placeholder="Телефон" required>
    <input type="date" name="weddingDate" placeholder="Дата свадьбы" required>

          </div>
          <div id="managerFields" style="display: none;">
            <input type="text" name="managerName" placeholder="Имя менеджера" required disabled>
          </div>
          <input type="email" name="email" placeholder="Email" required>
          <input type="password" name="pswd" placeholder="Пароль" required>
          <button type="submit">Sign up</button>
        </form>
      </div>

      <div class="login" id="login">
        <form id="loginForm">
          <label for="chk" aria-hidden="true">Login</label>
          <input type="email" name="email" placeholder="Email" required>
          <input type="password" name="pswd" placeholder="Password" required>
          <div id="managerLoginFields" style="display: none;">
            <input type="text" name="managerId" placeholder="Уникальный ID" required disabled>
          </div>
          <button type="submit">Login</button>
        </form>
        <p id="login-error" style="color: red; display: none;">Неверный email, пароль или ID!</p>
      </div>
    </div>
  </div>

  <script>
    let role = '';

    function selectRole(selectedRole) {
      role = selectedRole;
      document.getElementById('roleSelection').style.display = 'none';
      document.getElementById('forms').style.display = 'block';

      if (role === 'manager') {
        document.getElementById('coupleFields').style.display = 'none';
        document.querySelectorAll('#coupleFields input').forEach(input => input.disabled = true);

        document.getElementById('managerFields').style.display = 'block';
        document.querySelector('#managerFields input').disabled = false;

        document.getElementById('managerLoginFields').style.display = 'block';
        document.querySelector('#managerLoginFields input').disabled = false;
      } else {
        document.getElementById('managerFields').style.display = 'none';
        document.querySelector('#managerFields input').disabled = true;

        document.getElementById('managerLoginFields').style.display = 'none';
        document.querySelector('#managerLoginFields input').disabled = true;

        document.getElementById('coupleFields').style.display = 'block';
        document.querySelectorAll('#coupleFields input').forEach(input => input.disabled = false);
      }
    }

    // Регистрация: Сохранение данных пользователя
    document.getElementById('signupForm').addEventListener('submit', function(event) {
      event.preventDefault();

      if (role === 'couple') {
        const groomName = this.groomName.value;
        const brideName = this.brideName.value;
        const phone = this.phone.value;
        const weddingDate = this.weddingDate.value;
        const email = this.email.value;
        const password = this.pswd.value;

        // Генерация уникального ID
        const coupleId = `CPL-${Date.now()}`;

        localStorage.setItem('user', JSON.stringify({ 
          role, groomName, brideName, phone, weddingDate, email, password, coupleId 
        }));

        window.location.href = 'lk.html';
      } else if (role === 'manager') {
        const managerName = this.managerName.value;
        const email = this.email.value;
        const password = this.pswd.value;

        localStorage.setItem('user', JSON.stringify({ 
          role, managerName, email, password, managerId: Date.now() 
        }));

        window.location.href = 'lkman.html'; // Перенаправление менеджеров
      }
    });

    // Авторизация: Проверка email, пароля и ID (для менеджера)
    document.getElementById('loginForm').addEventListener('submit', function(event) {
      event.preventDefault();

      const email = this.email.value;
      const password = this.pswd.value;
      const managerId = this.managerId?.value;
      const user = JSON.parse(localStorage.getItem('user'));

      if (user && user.email === email && user.password === password) {
        if (role === 'manager' && user.managerId !== managerId) {
          document.getElementById('login-error').style.display = 'block';
        } else {
          window.location.href = role === 'manager' ? 'lkman.html' : 'lk.html';
        }
      } else {
        document.getElementById('login-error').style.display = 'block';
      }
    });
  </script>
</body>
</html>
